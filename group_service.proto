syntax = "proto3";
package qreeket;
option go_package = "github.com/qcodelabsllc/qreeket";

import "common.proto";
import "group.proto";

service GroupService {
  rpc createGroup(CreateGroupRequest) returns (Group);
  rpc getGroup(common.StringValue) returns (Group);
  // all groups a user is a member/admin of
  rpc getGroups(common.StringValue) returns (stream GroupList);
  rpc updateGroup(Group) returns (Group);
  rpc deleteGroup(DeleteGroupRequest) returns (common.Empty);
  rpc leaveGroup(ManageGroupOrChannel) returns (common.Empty);

  // admins can invite users to groups
  rpc inviteToGroup(GroupInviteRequest) returns (common.Empty);
  // get all group invites for a user
  rpc getGroupInvitesForUser(common.StringValue) returns (stream GroupInviteList);
  // get all group invites for a group
  rpc getGroupInvitesForGroup(common.StringValue) returns (stream GroupInviteList);
  // revoke a channel invite (only admins can revoke invites)
  rpc revokeGroupInvite(RevokeGroupInviteRequest) returns (common.Empty);
  // accept / decline a group invite
  rpc manageGroupInvite(ManageGroupInviteRequest) returns (common.Empty);
  // users can mute / unmute groups
  rpc muteGroup(ManageGroupOrChannelRequest) returns (common.Empty);
  rpc unmuteGroup(ManageGroupOrChannelRequest) returns (common.Empty);
  // promote / demote group admins (only group admins can promote / demote new admins)
  rpc promoteGroupAdmin(ManageAdminRequest) returns (common.Empty);
  rpc demoteGroupAdmin(ManageAdminRequest) returns (common.Empty);
  // admins can ban / unban users from groups
  rpc banFromGroup(ManageGroupOrChannelRequest) returns (common.Empty);
  rpc unbanFromGroup(ManageGroupOrChannelRequest) returns (common.Empty);
}

service ChannelService {
  rpc createChannel(CreateChannelRequest) returns (Channel);
  rpc getChannel(common.StringValue) returns (Channel);
  rpc getChannelsForGroup(common.StringValue) returns (stream ChannelList);
  rpc updateChannel(Channel) returns (Channel);
  rpc deleteChannel(common.StringValue) returns (common.Empty);
  rpc leaveChannel(ManageGroupOrChannel) returns (common.Empty);
  // user can only subscribe to / unsubscribe from public channels
  rpc subscribeToChannel(ChannelSubscriptionRequest) returns (common.Empty);
  rpc unsubscribeFromChannel(ChannelSubscriptionRequest) returns (common.Empty);
  rpc manageChannelSubscription(ManageChannelSubscriptionRequest) returns (common.Empty);
  rpc getChannelSubscriptionsForUser(common.StringValue) returns (stream ChannelSubscriptionList);
  // all users can mute / unmute channels
  rpc muteChannel(ManageGroupOrChannelRequest) returns (common.Empty);
  rpc unmuteChannel(ManageGroupOrChannelRequest) returns (common.Empty);
}